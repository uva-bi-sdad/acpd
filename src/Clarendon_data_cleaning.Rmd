---
title: "Claredon_data_cleaning"
author: "VH & JK"
date: "7/23/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(tidyverse)
library(data.table)


options(stringsAsFactors = FALSE)
my_workbook <- lapply(excel_sheets("~/acpd/data/acpd/Clarendon_details/Clarendon_details.xlsx"),
                      read_excel, col_types = c("date", "guess", "guess", "guess", "guess", "guess", "guess", 
                                               "text", "guess", "guess", "guess", "guess", "guess"),
                      path = "~/acpd/data/acpd/Clarendon_details/Clarendon_details.xlsx")


test2 <- do.call(rbind.data.frame, my_workbook)
head(test2)
(head(my_workbook))


clarendon_clean <- test2%>%
  drop_na(Establishment)%>%
  mutate(num_arrests = ifelse(is.na(Num_arrests) == FALSE, Num_arrests,
                              ifelse(`Arrest Type` == "N/A" | `Arrest Type` == "N"| is.na(`Arrest Type`), 0, 1)),
         Num_cfs = ifelse(is.na(as.numeric(Num_cfs)) == FALSE, as.numeric(Num_cfs), 1))%>%
  mutate(`Incident Type` = str_replace(`Incident Type`, "/", ","),
         Establishment = str_replace(Establishment, "/", ","))%>%
  separate_rows(col = Establishment, sep = ',') %>% 
  separate_rows(col = `Incident Type`, sep = ',')%>%
  #dt_mutate <- wday(label = TRUE, abbr = FALSE, ordered = FALSE) %>%
  group_by(Date, Establishment, `Incident Type`)%>%
  summarize(num_cfs = sum(Num_cfs), num_arrests = sum(num_arrests))



```

